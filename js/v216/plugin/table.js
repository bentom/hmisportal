Ext.onReady(function(){Ext.Ajax.method="GET";Ext.isIE=function(){return/trident/.test(Ext.userAgent)}();PT={};PT.instances=[];PT.i18n={};PT.isDebug=false;PT.isSessionStorage=("sessionStorage" in window&&window.sessionStorage!==null);PT.getCore=function(m){var i={},k={},j={},g={},h={},l;(function(){i.finals={url:{path_module:"/dhis-web-pivot/",organisationunitchildren_get:"getOrganisationUnitChildren.action"},dimension:{data:{value:"data",name:PT.i18n.data||"Data",dimensionName:"dx",objectName:"dx",warning:{filter:"..."}},category:{name:PT.i18n.assigned_categories||"Assigned categories",dimensionName:"co",objectName:"co"},indicator:{value:"indicators",name:PT.i18n.indicators||"Indicators",dimensionName:"dx",objectName:"in"},dataElement:{value:"dataElements",name:PT.i18n.data_elements||"Data elements",dimensionName:"dx",objectName:"de"},operand:{value:"operand",name:"Operand",dimensionName:"dx",objectName:"dc"},dataSet:{value:"dataSets",name:PT.i18n.data_sets||"Data sets",dimensionName:"dx",objectName:"ds"},period:{value:"period",name:PT.i18n.periods||"Periods",dimensionName:"pe",objectName:"pe"},fixedPeriod:{value:"periods"},relativePeriod:{value:"relativePeriods"},organisationUnit:{value:"organisationUnits",name:PT.i18n.organisation_units||"Organisation units",dimensionName:"ou",objectName:"ou"},dimension:{value:"dimension"},value:{value:"value"}},root:{id:"root"}};l=i.finals.dimension;l.objectNameMap={};l.objectNameMap[l.data.objectName]=l.data;l.objectNameMap[l.indicator.objectName]=l.indicator;l.objectNameMap[l.dataElement.objectName]=l.dataElement;l.objectNameMap[l.operand.objectName]=l.operand;l.objectNameMap[l.dataSet.objectName]=l.dataSet;l.objectNameMap[l.category.objectName]=l.category;l.objectNameMap[l.period.objectName]=l.period;l.objectNameMap[l.organisationUnit.objectName]=l.organisationUnit;l.objectNameMap[l.dimension.objectName]=l.dimension;l.objectNameMap.ou1=l.organisationUnit;l.objectNameMap.ou2=l.organisationUnit;l.objectNameMap.ou3=l.organisationUnit;i.period={periodTypes:[{id:"Daily",name:PT.i18n.daily},{id:"Weekly",name:PT.i18n.weekly},{id:"Monthly",name:PT.i18n.monthly},{id:"BiMonthly",name:PT.i18n.bimonthly},{id:"Quarterly",name:PT.i18n.quarterly},{id:"SixMonthly",name:PT.i18n.sixmonthly},{id:"SixMonthlyApril",name:PT.i18n.sixmonthly_april},{id:"Yearly",name:PT.i18n.yearly},{id:"FinancialOct",name:PT.i18n.financial_oct},{id:"FinancialJuly",name:PT.i18n.financial_july},{id:"FinancialApril",name:PT.i18n.financial_april}]};i.layout={west_width:424,west_fieldset_width:418,west_width_padding:2,west_fill:2,west_fill_accordion_indicator:56,west_fill_accordion_dataelement:59,west_fill_accordion_dataset:31,west_fill_accordion_period:284,west_fill_accordion_organisationunit:58,west_maxheight_accordion_indicator:400,west_maxheight_accordion_dataelement:400,west_maxheight_accordion_dataset:400,west_maxheight_accordion_period:513,west_maxheight_accordion_organisationunit:900,west_maxheight_accordion_group:340,west_maxheight_accordion_options:449,west_scrollbarheight_accordion_indicator:300,west_scrollbarheight_accordion_dataelement:300,west_scrollbarheight_accordion_dataset:300,west_scrollbarheight_accordion_period:450,west_scrollbarheight_accordion_organisationunit:450,west_scrollbarheight_accordion_group:300,east_tbar_height:31,east_gridcolumn_height:30,form_label_width:55,window_favorite_ypos:100,window_confirm_width:250,window_share_width:500,grid_favorite_width:420,grid_row_height:27,treepanel_minheight:135,treepanel_maxheight:400,treepanel_fill_default:310,treepanel_toolbar_menu_width_group:140,treepanel_toolbar_menu_width_level:120,multiselect_minheight:100,multiselect_maxheight:250,multiselect_fill_default:345,multiselect_fill_reportingrates:315};i.pivot={digitGroupSeparator:{comma:",",space:" "},displayDensity:{compact:"3px",normal:"6px",comfortable:"10px"},fontSize:{small:"10px",normal:"11px",large:"13px"}};i.url={analysisFields:["*","program[id,name]","programStage[id,name]","columns[dimension,filter,items[id,"+m.namePropertyUrl+"]]","rows[dimension,filter,items[id,"+m.namePropertyUrl+"]]","filters[dimension,filter,items[id,"+m.namePropertyUrl+"]]","!lastUpdated","!href","!created","!publicAccess","!rewindRelativePeriods","!userOrganisationUnit","!userOrganisationUnitChildren","!userOrganisationUnitGrandChildren","!externalAccess","!access","!relativePeriods","!columnDimensions","!rowDimensions","!filterDimensions","!user","!organisationUnitGroups","!itemOrganisationUnitGroups","!userGroupAccesses","!indicators","!dataElements","!dataElementOperands","!dataElementGroups","!dataSets","!periods","!organisationUnitLevels","!organisationUnits"]}}());(function(){k.layout={};k.layout.Record=function(n){var n=Ext.clone(n);return function(){if(!Ext.isObject(n)){console.log("Record: config is not an object: "+n);return}if(!Ext.isString(n.id)){alert("Record: id is not text: "+n);return}n.id=n.id.replace(".","#");return n}()};k.layout.Dimension=function(n){var n=Ext.clone(n);return function(){if(!Ext.isObject(n)){console.log("Dimension: config is not an object: "+n);return}if(!Ext.isString(n.dimension)){console.log("Dimension: name is not a string: "+n);return}if(n.dimension!==i.finals.dimension.category.objectName){var o=[];if(!Ext.isArray(n.items)){console.log("Dimension: items is not an array: "+n);return}for(var p=0;p<n.items.length;p++){o.push(k.layout.Record(n.items[p]))}n.items=Ext.Array.clean(o);if(!n.items.length){console.log("Dimension: has no valid items: "+n);return}}return n}()};k.layout.Layout=function(o){var p={},n,q;n=function(s){var s=Ext.clone(s);if(!(s&&Ext.isArray(s)&&s.length)){return}for(var r=0;r<s.length;r++){s[r]=k.layout.Dimension(s[r])}s=Ext.Array.clean(s);return s.length?s:null};q=function(){var t=i.finals.dimension,s,u={};if(!p){return}s=Ext.Array.clean([].concat(p.columns||[],p.rows||[],p.filters||[]));for(var r=0;r<s.length;r++){u[s[r].dimension]=s[r]}if(p.filters&&p.filters.length){for(var r=0;r<p.filters.length;r++){if(p.filters[r].dimension===t.indicator.objectName){h.message.alert(PT.i18n.indicators_cannot_be_specified_as_filter||"Indicators cannot be specified as filter");return}if(p.filters[r].dimension===t.category.objectName){h.message.alert(PT.i18n.categories_cannot_be_specified_as_filter||"Categories cannot be specified as filter");return}if(p.filters[r].dimension===t.dataSet.objectName){h.message.alert(PT.i18n.data_sets_cannot_be_specified_as_filter||"Data sets cannot be specified as filter");return}}}if(u[t.operand.objectName]&&u[t.indicator.objectName]){h.message.alert("Indicators and detailed data elements cannot be specified together");return}if(u[t.operand.objectName]&&u[t.dataElement.objectName]){h.message.alert("Detailed data elements and totals cannot be specified together");return}if(u[t.operand.objectName]&&u[t.dataSet.objectName]){h.message.alert("Data sets and detailed data elements cannot be specified together");return}if(u[t.operand.objectName]&&u[t.category.objectName]){h.message.alert("Assigned categories and detailed data elements cannot be specified together");return}return true};return function(){var r=[],t=i.finals.dimension;if(!(o&&Ext.isObject(o))){alert("Layout: config is not an object ("+m.el+")");return}o.columns=n(o.columns);o.rows=n(o.rows);o.filters=n(o.filters);if(!(o.columns||o.rows)){alert(PT.i18n.at_least_one_dimension_must_be_specified_as_row_or_column);return}for(var s=0,u=Ext.Array.clean([].concat(o.columns||[],o.rows||[],o.filters||[]));s<u.length;s++){if(k.layout.Dimension(u[s])){r.push(u[s].dimension)}}if(!Ext.Array.contains(r,t.period.objectName)){alert(PT.i18n.at_least_one_period_must_be_specified_as_column_row_or_filter);return}if(o.id){p.id=o.id}if(o.name){p.name=o.name}p.columns=o.columns;p.rows=o.rows;p.filters=o.filters;p.showColTotals=Ext.isBoolean(o.colTotals)?o.colTotals:(Ext.isBoolean(o.showColTotals)?o.showColTotals:true);p.showRowTotals=Ext.isBoolean(o.rowTotals)?o.rowTotals:(Ext.isBoolean(o.showRowTotals)?o.showRowTotals:true);p.showColSubTotals=Ext.isBoolean(o.colSubTotals)?o.colSubTotals:(Ext.isBoolean(o.showColSubTotals)?o.showColSubTotals:true);p.showRowSubTotals=Ext.isBoolean(o.rowSubTotals)?o.rowSubTotals:(Ext.isBoolean(o.showRowSubTotals)?o.showRowSubTotals:true);p.showDimensionLabels=Ext.isBoolean(o.showDimensionLabels)?o.showDimensionLabels:(Ext.isBoolean(o.showDimensionLabels)?o.showDimensionLabels:true);p.hideEmptyRows=Ext.isBoolean(o.hideEmptyRows)?o.hideEmptyRows:false;p.aggregationType=Ext.isString(o.aggregationType)?o.aggregationType:"default";p.showHierarchy=Ext.isBoolean(o.showHierarchy)?o.showHierarchy:false;p.displayDensity=Ext.isString(o.displayDensity)&&!Ext.isEmpty(o.displayDensity)?o.displayDensity:"normal";p.fontSize=Ext.isString(o.fontSize)&&!Ext.isEmpty(o.fontSize)?o.fontSize:"normal";p.digitGroupSeparator=Ext.isString(o.digitGroupSeparator)&&!Ext.isEmpty(o.digitGroupSeparator)?o.digitGroupSeparator:"space";p.legendSet=Ext.isObject(o.legendSet)&&Ext.isString(o.legendSet.id)?o.legendSet:null;p.parentGraphMap=Ext.isObject(o.parentGraphMap)?o.parentGraphMap:null;p.sorting=Ext.isObject(o.sorting)&&Ext.isDefined(o.sorting.id)&&Ext.isString(o.sorting.direction)?o.sorting:null;p.reportingPeriod=Ext.isObject(o.reportParams)&&Ext.isBoolean(o.reportParams.paramReportingPeriod)?o.reportParams.paramReportingPeriod:(Ext.isBoolean(o.reportingPeriod)?o.reportingPeriod:false);p.organisationUnit=Ext.isObject(o.reportParams)&&Ext.isBoolean(o.reportParams.paramOrganisationUnit)?o.reportParams.paramOrganisationUnit:(Ext.isBoolean(o.organisationUnit)?o.organisationUnit:false);p.parentOrganisationUnit=Ext.isObject(o.reportParams)&&Ext.isBoolean(o.reportParams.paramParentOrganisationUnit)?o.reportParams.paramParentOrganisationUnit:(Ext.isBoolean(o.parentOrganisationUnit)?o.parentOrganisationUnit:false);p.regression=Ext.isBoolean(o.regression)?o.regression:false;p.cumulative=Ext.isBoolean(o.cumulative)?o.cumulative:false;p.sortOrder=Ext.isNumber(o.sortOrder)?o.sortOrder:0;p.topLimit=Ext.isNumber(o.topLimit)?o.topLimit:0;if(!q()){return}return p}()};k.response={};k.response.Header=function(n){var n=Ext.clone(n);return function(){if(!Ext.isObject(n)){console.log("Header: config is not an object: "+n);return}if(!Ext.isString(n.name)){console.log("Header: name is not a string: "+n);return}if(!Ext.isBoolean(n.meta)){console.log("Header: meta is not boolean: "+n);return}return n}()};k.response.Response=function(n){var n=Ext.clone(n);return function(){if(!(n&&Ext.isObject(n))){console.log("Response: config is not an object");return}if(!(n.headers&&Ext.isArray(n.headers))){console.log("Response: headers is not an array");return}for(var o=0,p;o<n.headers.length;o++){n.headers[o]=k.response.Header(n.headers[o])}n.headers=Ext.Array.clean(n.headers);if(!n.headers.length){console.log("Response: no valid headers");return}if(!(Ext.isArray(n.rows)&&n.rows.length>0)){alert("No values found");return}if(n.headers.length!==n.rows[0].length){console.log("Response: headers.length !== rows[0].length")}return n}()}}());(function(){j.prototype={};j.prototype.array={};j.prototype.array.getLength=function(o,n){if(!Ext.isArray(o)){if(!n){console.log("support.prototype.array.getLength: not an array")}return null}return o.length};j.prototype.array.sort=function(p,o,n){if(!j.prototype.array.getLength(p)){return}n=n||"name";p.sort(function(r,q){if(Ext.isObject(r)&&Ext.isObject(q)&&n){r=r[n];q=q[n]}if(Ext.isString(r)&&Ext.isString(q)){r=r.toLowerCase();q=q.toLowerCase();if(o==="DESC"){return r<q?1:(r>q?-1:0)}else{return r<q?-1:(r>q?1:0)}}else{if(Ext.isNumber(r)&&Ext.isNumber(q)){return o==="DESC"?q-r:r-q}}return -1});return p};j.prototype.object={};j.prototype.object.getLength=function(n,q){if(!Ext.isObject(n)){if(!q){console.log("support.prototype.object.getLength: not an object")}return null}var p=0;for(var o in n){if(n.hasOwnProperty(o)){p++}}return p};j.prototype.object.hasObject=function(o,r,q){if(!j.prototype.object.getLength(o)){return null}for(var p in o){var n=o[p];if(o.hasOwnProperty(p)&&n[r]===q){return true}}return null};j.prototype.str={};j.prototype.str.replaceAll=function(p,o,n){return p.replace(new RegExp(o,"g"),n)};j.prototype.str.toggleDirection=function(n){return n==="DESC"?"ASC":"DESC"};j.prototype.number={};j.prototype.number.getNumberOfDecimals=function(n){var o=new String(n);return(o.indexOf(".")>-1)?(o.length-o.indexOf(".")-1):0};j.prototype.number.roundIf=function(p,n){p=parseFloat(p);n=parseFloat(n);if(Ext.isNumber(p)&&Ext.isNumber(n)){var o=j.prototype.number.getNumberOfDecimals(p);return o>n?Ext.Number.toFixed(p,n):p}return p};j.prototype.number.prettyPrint=function(n,o){o=o||"space";if(o==="none"){return n}return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,i.pivot.digitGroupSeparator[o])};j.color={};j.color.hexToRgb=function(p){var o=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,n;p=p.replace(o,function(s,u,t,q){return u+u+t+t+q+q});n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(p);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null}}());(function(){g.layout={};g.layout.cleanDimensionArray=function(o){if(!j.prototype.array.getLength(o)){return null}var p=[];for(var n=0;n<o.length;n++){p.push(k.layout.Dimension(o[n]))}p=Ext.Array.clean(p);return p.length?p:null};g.layout.sortDimensionArray=function(q,p){if(!j.prototype.array.getLength(q,true)){return null}q=g.layout.cleanDimensionArray(q);if(!q){console.log("service.layout.sortDimensionArray: no valid dimensions");return null}p=p||"dimensionName";Ext.Array.sort(q,function(s,r){if(s[p]<r[p]){return -1}if(s[p]>r[p]){return 1}return 0});for(var o=0,n;o<q.length;o++){j.prototype.array.sort(q[o].items,"ASC","id");if(j.prototype.array.getLength(q[o].ids)){j.prototype.array.sort(q[o].ids)}}return q};g.layout.getObjectNameDimensionMapFromDimensionArray=function(q){var p={};if(!j.prototype.array.getLength(q)){return null}for(var n=0,o;n<q.length;n++){o=k.layout.Dimension(q[n]);if(o){p[o.dimension]=o}}return j.prototype.object.getLength(p)?p:null};g.layout.getObjectNameDimensionItemsMapFromDimensionArray=function(q){var p={};if(!j.prototype.array.getLength(q)){return null}for(var n=0,o;n<q.length;n++){o=k.layout.Dimension(q[n]);if(o){p[o.dimension]=o.items}}return j.prototype.object.getLength(p)?p:null};g.layout.getItemName=function(t,p,u,s){var o=p.metaData,q="";if(g.layout.isHierarchy(t,p,u)){var n=Ext.Array.clean(o.ouHierarchy[u].split("/"));n.shift();for(var r=0;r<n.length;r++){q+=(s?'<span class="text-weak">':"")+o.names[n[r]]+(s?"</span>":"")+" / "}}q+=o.names[u];return q};g.layout.getExtendedLayout=function(s){var s=Ext.clone(s),u;u={columns:[],rows:[],filters:[],columnObjectNames:[],columnDimensionNames:[],rowObjectNames:[],rowDimensionNames:[],axisDimensions:[],axisObjectNames:[],axisDimensionNames:[],sortedAxisDimensionNames:[],filterDimensions:[],filterObjectNames:[],filterDimensionNames:[],sortedFilterDimensions:[],dimensions:[],objectNames:[],dimensionNames:[],objectNameDimensionsMap:{},objectNameItemsMap:{},objectNameIdsMap:{},dimensionNameDimensionsMap:{},dimensionNameItemsMap:{},dimensionNameIdsMap:{},dimensionNameSortedIdsMap:{},dimensionNameAxisMap:{}};Ext.applyIf(u,s);if(s.columns){for(var q=0,r,t,n;q<s.columns.length;q++){r=s.columns[q];t=r.items;n={};n.dimension=r.dimension;n.objectName=r.dimension;n.dimensionName=l.objectNameMap[r.dimension].dimensionName;if(t){n.items=t;n.ids=[];for(var p=0;p<t.length;p++){n.ids.push(t[p].id)}}u.columns.push(n);u.columnObjectNames.push(n.objectName);u.columnDimensionNames.push(n.dimensionName);u.axisDimensions.push(n);u.axisObjectNames.push(n.objectName);u.axisDimensionNames.push(l.objectNameMap[n.objectName].dimensionName);u.objectNameDimensionsMap[n.objectName]=n;u.objectNameItemsMap[n.objectName]=n.items;u.objectNameIdsMap[n.objectName]=n.ids;u.dimensionNameAxisMap[n.dimensionName]=u.columns}}if(s.rows){for(var q=0,r,t,n;q<s.rows.length;q++){r=Ext.clone(s.rows[q]);t=r.items;n={};n.dimension=r.dimension;n.objectName=r.dimension;n.dimensionName=l.objectNameMap[r.dimension].dimensionName;if(t){n.items=t;n.ids=[];for(var p=0;p<t.length;p++){n.ids.push(t[p].id)}}u.rows.push(n);u.rowObjectNames.push(n.objectName);u.rowDimensionNames.push(n.dimensionName);u.axisDimensions.push(n);u.axisObjectNames.push(n.objectName);u.axisDimensionNames.push(l.objectNameMap[n.objectName].dimensionName);u.objectNameDimensionsMap[n.objectName]=n;u.objectNameItemsMap[n.objectName]=n.items;u.objectNameIdsMap[n.objectName]=n.ids;u.dimensionNameAxisMap[n.dimensionName]=u.rows}}if(s.filters){for(var q=0,r,t,n;q<s.filters.length;q++){r=s.filters[q];t=r.items;n={};n.dimension=r.dimension;n.objectName=r.dimension;n.dimensionName=l.objectNameMap[r.dimension].dimensionName;if(t){n.items=t;n.ids=[];for(var p=0;p<t.length;p++){n.ids.push(t[p].id)}}u.filters.push(n);u.filterDimensions.push(n);u.filterObjectNames.push(n.objectName);u.filterDimensionNames.push(l.objectNameMap[n.objectName].dimensionName);u.objectNameDimensionsMap[n.objectName]=n;u.objectNameItemsMap[n.objectName]=n.items;u.objectNameIdsMap[n.objectName]=n.ids;u.dimensionNameAxisMap[n.dimensionName]=u.filters}}u.legendSet=s.legendSet?m.idLegendSetMap[s.legendSet.id]:null;if(s.legendSet){u.legendSet=m.idLegendSetMap[s.legendSet.id];j.prototype.array.sort(u.legendSet.mapLegends,"ASC","startValue")}u.axisDimensionNames=Ext.Array.unique(u.axisDimensionNames);u.filterDimensionNames=Ext.Array.unique(u.filterDimensionNames);u.columnDimensionNames=Ext.Array.unique(u.columnDimensionNames);u.rowDimensionNames=Ext.Array.unique(u.rowDimensionNames);u.filterDimensionNames=Ext.Array.unique(u.filterDimensionNames);u.sortedAxisDimensionNames=Ext.clone(u.axisDimensionNames).sort();u.sortedFilterDimensions=g.layout.sortDimensionArray(Ext.clone(u.filterDimensions));u.dimensions=[].concat(u.axisDimensions,u.filterDimensions);u.objectNames=[].concat(u.axisObjectNames,u.filterObjectNames);u.dimensionNames=[].concat(u.axisDimensionNames,u.filterDimensionNames);for(var q=0,o;q<u.dimensionNames.length;q++){o=u.dimensionNames[q];u.dimensionNameDimensionsMap[o]=[];u.dimensionNameItemsMap[o]=[];u.dimensionNameIdsMap[o]=[]}for(var q=0,n;q<u.dimensions.length;q++){n=u.dimensions[q];u.dimensionNameDimensionsMap[n.dimensionName].push(n);u.dimensionNameItemsMap[n.dimensionName]=u.dimensionNameItemsMap[n.dimensionName].concat(n.items);u.dimensionNameIdsMap[n.dimensionName]=u.dimensionNameIdsMap[n.dimensionName].concat(n.ids)}for(var v in u.dimensionNameIdsMap){if(u.dimensionNameIdsMap.hasOwnProperty(v)){u.dimensionNameSortedIdsMap[v]=Ext.clone(u.dimensionNameIdsMap[v]).sort()}}u.tableUuid=m.el+"_"+Ext.data.IdGenerator.get("uuid").generate();return u};g.layout.getSyncronizedXLayout=function(z,n){var E,s=Ext.Array.clean([].concat(z.columns||[],z.rows||[],z.filters||[])),N=z.objectNameDimensionsMap[l.organisationUnit.objectName],w=N&&Ext.Array.contains(N.ids,"USER_ORGUNIT"),P=N&&Ext.Array.contains(N.ids,"USER_ORGUNIT_CHILDREN"),M=N&&Ext.Array.contains(N.ids,"USER_ORGUNIT_GRANDCHILDREN"),o=function(){if(N&&Ext.isArray(N.ids)){for(var R=0;R<N.ids.length;R++){if(N.ids[R].substr(0,5)==="LEVEL"){return true}}}return false}(),y=function(){if(N&&Ext.isArray(N.ids)){for(var R=0;R<N.ids.length;R++){if(N.ids[R].substr(0,8)==="OU_GROUP"){return true}}}return false}(),v=l.category.objectName,r=l.organisationUnit.objectName,p=function(){var S=[];for(var R=0;R<n.headers.length;R++){S.push(n.headers[R].name)}return S}(),Q;E=function(S){var R;R=function(U){var V;U=Ext.clone(U);for(var T=0;T<U.length;T++){if(U[T].dimension===S){V=U[T]}}if(V){Ext.Array.remove(U,V)}return U};if(z.columns){z.columns=R(z.columns)}if(z.rows){z.rows=R(z.rows)}if(z.filters){z.filters=R(z.filters)}};for(var I=0,G,x,A;I<s.length;I++){G=s[I];G.items=[];x=n.metaData[G.objectName];if(G.dimensionName===r){if(w||P||M){var L,u,C;if(m.user&&w){L=[];for(var F=0;F<m.user.ou.length;F++){L.push({id:m.user.ou[F],name:g.layout.getItemName(z,n,m.user.ou[F],false)})}}if(m.user&&m.user.ouc&&P){u=[];for(var F=0;F<m.user.ouc.length;F++){u.push({id:m.user.ouc[F],name:g.layout.getItemName(z,n,m.user.ouc[F],false)})}j.prototype.array.sort(u)}if(m.user&&m.user.ouc&&M){var q=[].concat(m.user.ou,m.user.ouc),t=n.metaData[r];C=[];for(var F=0,B;F<t.length;F++){B=t[F];if(!Ext.Array.contains(q,B)){C.push({id:B,name:g.layout.getItemName(z,n,B,false)})}}j.prototype.array.sort(C)}G.items=[].concat(L||[],u||[],C||[])}else{if(o||y){for(var F=0,t=n.metaData[r],B;F<t.length;F++){B=t[F];G.items.push({id:B,name:g.layout.getItemName(z,n,B,false)})}j.prototype.array.sort(G.items)}else{G.items=Ext.clone(z.dimensionNameItemsMap[G.dimensionName])}}}else{if(Ext.isArray(x)&&x.length){var D=Ext.clone(n.metaData[G.dimensionName]);for(var F=0;F<D.length;F++){G.items.push({id:D[F],name:n.metaData.names[D[F]]})}}else{G.items=Ext.clone(z.objectNameItemsMap[G.objectName])}}}s=Ext.Array.clean([].concat(z.columns||[],z.rows||[],z.filters||[]));for(var I=0,H=n.metaData.names,K;I<s.length;I++){K=s[I].items;if(Ext.isArray(K)&&K.length){for(var F=0,O;F<K.length;F++){O=K[F];if(Ext.isObject(O)&&Ext.isString(H[O.id])&&!Ext.isString(O.name)){O.name=H[O.id]||""}}}}for(var I=0,J;I<z.axisDimensionNames.length;I++){J=z.axisDimensionNames[I];if(!Ext.Array.contains(p,J)){E(J)}}Q=k.layout.Layout(z);if(Q){return g.layout.getExtendedLayout(Q)}return null};g.layout.getExtendedAxis=function(B,ad){var t,r,D=[],z=1,N,q,H=[],ac=[],s=[],G=[],x=[],y=[],Q=[],u={};if(ad==="col"){t=Ext.clone(B.columnDimensionNames);r="colSpan"}else{if(ad==="row"){t=Ext.clone(B.rowDimensionNames);r="rowSpan"}}if(!(Ext.isArray(t)&&t.length)){return}for(var X=0;X<t.length;X++){D.push({dimensionName:t[X]})}q=function(){var n=[];for(var ae=0;ae<D.length;ae++){n.push(B.dimensionNameIdsMap[D[ae].dimensionName])}return n}();N=q.length;for(var X=0,O;X<N;X++){O=q[X].length;H.push(O);z=z*O;ac.push(z)}for(var X=0;X<N;X++){if(H[X]===1){if(X===0){s.push(z)}else{if(B.hideEmptyRows&&ad==="row"){s.push(z/ac[X])}else{s.push(s[0])}}}else{s.push(z/ac[X])}}G.push(q[0]);if(N.length>1){for(var X=1,aa,R;X<N;X++){aa=[];R=H[X]===1?H[0]:ac[X-1];for(var V=0;V<R;V++){aa=aa.concat(q[X])}G.push(aa)}}for(var X=0,w,S,E,W;X<N;X++){w=[];S=q[X];E=s[X];W=z/(E*S.length);for(var V=0;V<W;V++){for(var U=0;U<S.length;U++){for(var T=0;T<E;T++){w.push(S[U])}}}x.push(w)}for(var X=0,M;X<z;X++){M="";for(var V=0;V<N;V++){M+=x[V][X]}if(M){y.push(M)}}for(var X=0,J;X<x.length;X++){J=[];for(var V=0,p;V<x[X].length;V++){p={id:x[X][V],uuid:Ext.data.IdGenerator.get("uuid").generate(),dim:X,axis:ad};if(X===x.length-1){p.leaf=true}J.push(p)}Q.push(J)}for(var X=0,I,L,Z;X<Q.length;X++){L=[];for(var V=0,p,ab=0,o;V<Q[X].length;V++){p=Q[X][V];L.push(p.id);if(ab===0){p[r]=s[X];if(p.leaf){p.children=0}p.oldest=true;if(X===0){p.root=true}o=p}p.oldestSibling=o;if(++ab===s[X]){ab=0}}if(X>0){I=Q[X-1];Z=Ext.Array.unique(L);for(var V=0;V<I.length;V++){I[V].children=Z.length}}}if(N>1){for(var X=1,A;X<N;X++){A=Q[X];for(var V=0,ab=0,E=s[X-1];V<A.length;V++){A[V].parent=Q[X-1][V]}}}if(Q.length){var v=N>1?j.prototype.array.sort(Ext.clone(s))[1]:z,C=Q[Q.length-1];for(var X=0,Y,F,p,K=[];X<C.length;X++){Y=C[X];K.push(Y.uuid);F=[];p=Y;while(p.parent){p=p.parent;F.push(p.oldestSibling.uuid)}Y.uuids=Ext.clone(F);if(K.length===v){for(var V=(X-v)+1,Y;V<=X;V++){Y=C[V];Y.uuids=Y.uuids.concat(K)}K=[]}}}for(var X=0;X<Q.length;X++){for(var V=0,P;V<Q[X].length;V++){P=Q[X][V];u[P.uuid]=P}}return{type:ad,items:D,xItems:{unique:q,gui:G,all:x},objects:{all:Q},ids:y,span:s,dims:N,size:z,uuidObjectMap:u}};g.layout.isHierarchy=function(o,n,p){return o.showHierarchy&&Ext.isObject(n.metaData.ouHierarchy)&&n.metaData.ouHierarchy.hasOwnProperty(p)};g.layout.layout2plugin=function(s,p){var s=Ext.clone(s),r=Ext.Array.clean([].concat(s.columns||[],s.rows||[],s.filters||[]));s.url=m.contextPath;if(p){s.el=p}if(Ext.isString(s.id)){return{id:s.id}}for(var o=0,t,q;o<r.length;o++){t=r[o];delete t.id;delete t.ids;delete t.type;delete t.dimensionName;delete t.objectName;for(var n=0,q;n<t.items.length;n++){q=t.items[n];delete q.name;delete q.code;delete q.created;delete q.lastUpdated;delete q.value}}if(s.showRowTotals){delete s.showRowTotals}if(s.showColTotals){delete s.showColTotals}if(s.showColSubTotals){delete s.showColSubTotals}if(s.showRowSubTotals){delete s.showRowSubTotals}if(!s.hideEmptyRows){delete s.hideEmptyRows}if(!s.showHierarchy){delete s.showHierarchy}if(s.displayDensity==="normal"){delete s.displayDensity}if(s.fontSize==="normal"){delete s.fontSize}if(s.digitGroupSeparator==="space"){delete s.digitGroupSeparator}if(!s.legendSet){delete s.legendSet}if(!s.sorting){delete s.sorting}delete s.parentGraphMap;delete s.reportingPeriod;delete s.organisationUnit;delete s.parentOrganisationUnit;delete s.regression;delete s.cumulative;delete s.sortOrder;delete s.topLimit;delete s.aggregationType;return s};g.response={};g.response.getExtendedResponse=function(o,n){var p=[];n=Ext.clone(n);n.nameHeaderMap={};n.idValueMap={};(function(){for(var q=0,r;q<n.headers.length;q++){r=n.headers[q];r.index=q;if(r.meta){r.ids=Ext.clone(o.dimensionNameIdsMap[r.name])||[];r.size=r.ids.length;p=p.concat(r.ids)}}for(var q=0,r;q<n.headers.length;q++){r=n.headers[q];n.nameHeaderMap[r.name]=r}}());(function(){for(var q=0,s,r;q<p.length;q++){s=p[q];if(s.indexOf("#")!==-1){r=s.split("#");n.metaData.names[s]=n.metaData.names[r[0]]+" "+n.metaData.names[r[1]]}}}());(function(){var w=n.nameHeaderMap[i.finals.dimension.value.value].index,r=n.nameHeaderMap[i.finals.dimension.category.dimensionName],A=l.data.dimensionName,x=l.category.dimensionName,t=o.axisDimensionNames,y=[];for(var u=0;u<t.length;u++){y.push(n.nameHeaderMap[t[u]].index);if(r&&!Ext.Array.contains(t,x)&&t[u]===A){y.push(r.index)}}for(var u=0,z,q;u<n.rows.length;u++){z=n.rows[u];q="";for(var s=0,v;s<y.length;s++){v=y[s];q+=z[v]}n.idValueMap[q]=z[w]}}());return n};g.response.addOuHierarchyDimensions=function(q){var o=q.headers,n=q.metaData.ouHierarchy,y=q.rows,s,w=0,u=[],p=[],v;if(!n){return}for(var r=0;r<o.length;r++){if(o[r].name==="ou"){s=r;break}}for(var r=0;r<y.length;r++){w=Math.max(w,Ext.Array.clean(n[y[r][s]].split("/")).length)}for(var r=0;r<w;r++){u.push("")}for(var r=0,x,t;r<y.length;r++){x=y[r];t=Ext.applyIf(Ext.Array.clean(n[x[s]].split("/")),Ext.clone(u));Ext.Array.insert(x,s,t)}for(var r=0;r<w;r++){p.push({column:"Organisation unit",hidden:false,meta:true,name:"ou",type:"java.lang.String"})}Ext.Array.insert(o,s,p);return q};g.response.getValue=function(o){var p=parseFloat(o);if(Ext.isBoolean(o)){return 1}if(!Ext.isNumber(p)||p!=o){return 0}return p}}());(function(){h.mask={};h.mask.show=function(n,o){if(!Ext.isObject(n)){console.log("support.gui.mask.show: component not an object");return null}o=o||"Loading..";if(n.mask&&n.mask.destroy){n.mask.destroy();n.mask=null}n.mask=new Ext.create("Ext.LoadMask",n,{shadow:false,msg:o,style:"box-shadow:0",bodyStyle:"box-shadow:0"});n.mask.show()};h.mask.hide=function(n){if(!Ext.isObject(n)){console.log("support.gui.mask.hide: component not an object");return null}if(n.mask){n.mask.destroy();n.mask=null}};h.message={};h.message.alert=function(n){console.log(n)};h.analytics={};h.analytics.getParamString=function(B,q){var v=q?B.sortedAxisDimensionNames:B.axisDimensionNames,C=q?B.sortedFilterDimensions:B.filterDimensions,n=q?B.dimensionNameSortedIdsMap:B.dimensionNameIdsMap,r="?",p=false,o=B.dimensionNameItemsMap,D=l.indicator.dimensionName,A=l.category.dimensionName,t={count:"COUNT",sum:"SUM",stddev:"STDDEV",variance:"VARIANCE",min:"MIN",max:"MAX"};for(var w=0,s,z;w<v.length;w++){s=v[w];r+="dimension="+s;z=Ext.clone(n[s]);if(s===D){for(var u=0,y;u<z.length;u++){y=z[u].indexOf("#");if(y>0){p=true;z[u]=z[u].substr(0,y)}}z=Ext.Array.unique(z)}if(s!==A){r+=":"+z.join(";")}if(w<(v.length-1)){r+="&"}}if(p){r+="&dimension="+i.finals.dimension.category.dimensionName}if(Ext.isArray(C)&&C.length){for(var w=0,x;w<C.length;w++){x=C[w];r+="&filter="+x.dimensionName+":"+x.ids.join(";")}}if(B.showHierarchy){r+="&hierarchyMeta=true"}if(t.hasOwnProperty(B.aggregationType)){r+="&aggregationType="+t[B.aggregationType]}r+="&displayProperty="+m.userAccount.settings.keyAnalysisDisplayProperty.toUpperCase();return r};h.analytics.validateUrl=function(o){var p;if(Ext.isIE){p="Too many items selected (url has "+o.length+" characters). Internet Explorer accepts maximum 2048 characters."}else{var n=o.length>8000?"8000":(o.length>4000?"4000":"2000");p="Too many items selected (url has "+o.length+" characters). Please reduce to less than "+n+" characters."}p+="\n\nHint: A good way to reduce the number of items is to use relative periods and level/group organisation unit selection modes.";alert(p)};h.pivot={};h.pivot.sort=function(t,y,n){var y=Ext.clone(y),o=t.sorting.id,r=t.rows[0],p=y.idValueMap,u=t.sorting?t.sorting.direction:"DESC",s;r.ids=[];if(Ext.isString(o)){o=o.toLowerCase()==="total"?"total_":o}else{if(Ext.isNumber(o)){if(o===0){o="total_"}else{o=n.ids[parseInt(o)-1]}}else{return t}}for(var q=0,x,w,v;q<r.items.length;q++){x=r.items[q];w=o+x.id;v=parseFloat(p[w]);x.value=Ext.isNumber(v)?v:(Number.MAX_VALUE*-1)}j.prototype.array.sort(r.items,u,"value");for(var q=0;q<r.items.length;q++){r.ids.push(r.items[q].id)}if(o!==t.sorting.id){t.sorting.id=o}return t};h.pivot.getHtml=function(F,o,L,E){var y,G,n,r,s,w,I,u,q,x,C,H,N,v=function(O){var P;if(!O){return null}P=O.xItems.unique;if(P){return P.length<2?1:(O.size/P[0].length)}return null},K=v(L),D=v(E),B=[],M=[],t=[],A={},z=Ext.isObject(F.legendSet)&&Ext.isArray(F.legendSet.mapLegends)&&F.legendSet.mapLegends.length,p=0,J;o.sortableIdObjects=[];y=function(O,P){P=P||2;return parseFloat(j.prototype.number.roundIf(O,2)).toString()};G=function(R,ab){var Y,Z,U,W,P,Q,ad,O=Ext.isObject(R)&&Ext.isString(R.type)&&R.type.substr(0,5)==="value"&&!R.empty,X=O&&R.type==="value",ac="",T="",V;V=function(ae){var af=ae.htmlValue,ag=parseFloat(ae.htmlValue);if(ae.collapsed){return""}if(X){if(Ext.isBoolean(af)){return af}if(!Ext.isNumber(ag)||ag!=af){return af}return ag}return af||""};if(!Ext.isObject(R)){return""}if(R.hidden||R.collapsed){return""}p=p+1;if(X&&F.legendSet){var aa=parseFloat(R.value);Z=F.legendSet.mapLegends;for(var S=0;S<Z.length;S++){if(Ext.Number.constrain(aa,Z[S].startValue,Z[S].endValue)===aa){Y=Z[S].color}}}U=R.colSpan?'colspan="'+R.colSpan+'" ':"";W=R.rowSpan?'rowspan="'+R.rowSpan+'" ':"";P=V(R);P=R.type!=="dimension"?j.prototype.number.prettyPrint(P,F.digitGroupSeparator):P;Q=i.pivot.displayDensity[R.displayDensity]||i.pivot.displayDensity[F.displayDensity];ad=i.pivot.fontSize[R.fontSize]||i.pivot.fontSize[F.fontSize];ac+=R.hidden?" td-hidden":"";ac+=R.collapsed?" td-collapsed":"";ac+=X?" pointer":"";ac+=R.cls?" "+R.cls:"";if(Ext.isString(ab)){ac+=" td-sortable";o.sortableIdObjects.push({id:ab,uuid:R.uuid})}T+="<td "+(R.uuid?('id="'+R.uuid+'" '):"");T+=' class="'+ac+'" '+U+W;T+='style="'+(Y&&X?"color:"+Y+"; ":"")+"padding:"+Q+"; font-size:"+ad+';">'+P+"</td>";return T};s=function(){return !!F.showColTotals};r=function(){return !!F.showRowTotals};doColSubTotals=function(){return !!F.showColSubTotals&&E&&E.dims>1};doRowSubTotals=function(){return !!F.showRowSubTotals&&L&&L.dims>1};w=function(){return(E&&E.dims===1)};I=function(){var X=[],O;getEmptyNameTdConfig=function(Y){Y=Y||{};return G({cls:Y.cls?" "+Y.cls:"pivot-empty",colSpan:Y.colSpan?Y.colSpan:1,rowSpan:Y.rowSpan?Y.rowSpan:1,htmlValue:Y.htmlValue?Y.htmlValue:"&nbsp;"})};O=function(aa){var Y=[];if(aa<L.dims-1){if(E&&E.dims){for(var Z=0;Z<E.dims-1;Z++){Y.push(getEmptyNameTdConfig({cls:"pivot-dim-label"}))}}Y.push(getEmptyNameTdConfig({cls:"pivot-dim-label",htmlValue:l.objectNameMap[F.columnObjectNames[aa]].name}))}else{if(E&&E.dims){for(var Z=0;Z<E.dims-1;Z++){Y.push(getEmptyNameTdConfig({cls:"pivot-dim-label",htmlValue:l.objectNameMap[F.rowObjectNames[Z]].name}))}}Y.push(getEmptyNameTdConfig({cls:"pivot-dim-label",htmlValue:(E?l.objectNameMap[F.rowObjectNames[Z]].name:"")+(L&&E?"&nbsp;/&nbsp;":"")+(L?l.objectNameMap[F.columnObjectNames[aa]].name:"")}))}return Y};if(!L){if(E&&F.showDimensionLabels){var W=[];for(var T=0;T<F.rowObjectNames.length;T++){W.push(getEmptyNameTdConfig({cls:"pivot-dim-label",htmlValue:l.objectNameMap[F.rowObjectNames[T]].name}))}X.push(W)}return X}for(var T=0,V;T<L.dims;T++){V=[];if(F.showDimensionLabels){V=V.concat(O(T))}else{if(T===0){V.push(L&&E?getEmptyNameTdConfig({colSpan:E.dims,rowSpan:L.dims}):"")}}for(var R=0,S,P=0,U,Q;R<L.size;R++){P++;U=null;Q=null;S=L.objects.all[T][R];S.type="dimension";S.cls="pivot-dim";S.noBreak=false;S.hidden=!(S.rowSpan||S.colSpan);S.htmlValue=g.layout.getItemName(F,o,S.id,true);if(T===L.dims-1&&w()){U=L.ids[R]}V.push(G(S,U));if(T===0&&P===L.span[T]&&doRowSubTotals()){V.push(G({type:"dimensionSubtotal",cls:"pivot-dim-subtotal cursor-default",rowSpan:L.dims,htmlValue:"&nbsp;"}));P=0}if(T===0&&(R===L.size-1)&&r()){Q=w()?"total_":null;V.push(G({uuid:Ext.data.IdGenerator.get("uuid").generate(),type:"dimensionTotal",cls:"pivot-dim-total",rowSpan:L.dims,htmlValue:"Total"},Q))}}X.push(V)}return X};u=function(){var aE=[],aa=[],ap,U=[],ai=[],ae,ag=L?L.size:1,ar=E?E.size:1,ah;ah=function(aF){if(!aF.children){aF.collapsed=true;if(aF.parent){aF.parent.oldestSibling.children--}}if(aF.parent){ah(aF.parent.oldestSibling)}};if(E){for(var aA=0,ac;aA<E.size;aA++){ac=[];for(var az=0,S,au;az<E.dims;az++){S=E.objects.all[az][aA];S.type="dimension";S.cls="pivot-dim td-nobreak"+(g.layout.isHierarchy(F,o,S.id)?" align-left":"");S.noBreak=true;S.hidden=!(S.rowSpan||S.colSpan);S.htmlValue=g.layout.getItemName(F,o,S.id,true);ac.push(S)}aa.push(ac)}}else{if(F.showDimensionLabels){aa.push([{type:"transparent",cls:"pivot-transparent-row"}])}}for(var aA=0,Q,T,ax=o.idValueMap;aA<ar;aA++){Q=[];T=[];for(var az=0,ao,av,am,aC,O,V,P;az<ag;az++){O=false;P=[];ao=((L?L.ids[az]:"")+(E?E.ids[aA]:"")).replace("#","");V=Ext.data.IdGenerator.get("uuid").generate();if(L){P=P.concat(L.objects.all[L.dims-1][az].uuids)}if(E){P=P.concat(E.objects.all[E.dims-1][aA].uuids)}am=ax[ao];if(Ext.isDefined(am)){av=g.response.getValue(am);aC=am}else{av=0;aC="&nbsp;";O=true}Q.push(av);T.push({uuid:V,type:"value",cls:"pivot-value"+(O?" cursor-default":""),value:av,htmlValue:aC,empty:O,uuids:P});A[V]=P}B.push(Q);M.push(T)}if(L&&r()){for(var aA=0,O=[],al=0;aA<M.length;aA++){for(az=0,S;az<M[aA].length;az++){S=M[aA][az];O.push(S.empty);al+=S.value}U.push({type:"valueTotal",cls:"pivot-value-total",value:al,htmlValue:Ext.Array.contains(O,false)?y(al):"",empty:!Ext.Array.contains(O,false)});if(w()){var Z="total_"+E.ids[aA],ad=!Ext.Array.contains(O,false);o.idValueMap[Z]=ad?null:al}O=[];al=0}}if(L&&E){if(F.hideEmptyRows){for(var aA=0,aq,R,af;aA<M.length;aA++){aq=M[aA];R=!Ext.Array.contains(Ext.Array.pluck(aq,"empty"),false);if(R){for(var az=0;az<aq.length;az++){aq[az].collapsed=true}if(r()){U[aA].collapsed=true}af=aa[aA][E.dims-1];ah(af)}}}}ap=M;if(doRowSubTotals()){var aj=[];for(var aA=0,ac,Y,ab;aA<ap.length;aA++){ac=[];Y=0;ab=0;for(var az=0,ak,aD=[],O=[];az<ap[aA].length;az++){ak=ap[aA][az];Y+=ak.value;O.push(!!ak.empty);aD.push(!!ak.collapsed);ab++;ac.push(ak);if(ab===K){var ad=!Ext.Array.contains(O,false);ac.push({type:"valueSubtotal",cls:"pivot-value-subtotal"+(ad?" cursor-default":""),value:Y,htmlValue:ad?"&nbsp;":y(Y),empty:ad,collapsed:!Ext.Array.contains(aD,false)});ab=0;Y=0;O=[];aD=[]}}aj.push(ac)}ap=aj}if(doColSubTotals()){var an=[],aj=[],aB=[],ay;ay=function(aI){var aH=[];for(var aF=0,aG;aF<E.dims;aF++){aG={};aG.type="dimensionSubtotal";aG.cls="pivot-dim-subtotal cursor-default";aG.collapsed=Ext.Array.contains(aI,true);if(aF===0){aG.htmlValue="&nbsp;";aG.colSpan=E.dims}else{aG.hidden=true}aH.push(aG)}return aH};for(var aA=0,ac,aD=[];aA<aa.length;aA++){an.push(aa[aA]);aD.push(!!aa[aA][0].collapsed);if(!Ext.isArray(aa[aA+1])||!!aa[aA+1][0].root){an.push(ay(aD));aD=[]}}for(var aA=0;aA<an.length;aA++){aj.push([])}for(var aA=0;aA<ap[0].length;aA++){for(var az=0,W=0,at=0,X=0,O=[],aD,ak;az<ap.length;az++){ak=ap[az][aA];aj[at++].push(ak);X+=ak.value;O.push(!!ak.empty);W++;if(aa[az][0].root){aD=!!aa[az][0].collapsed}if(!Ext.isArray(aa[az+1])||aa[az+1][0].root){var ad=!Ext.Array.contains(O,false);aj[at++].push({type:ak.type==="value"?"valueSubtotal":"valueSubtotalTotal",value:X,htmlValue:ad?"&nbsp;":y(X),collapsed:aD,cls:(ak.type==="value"?"pivot-value-subtotal":"pivot-value-subtotal-total")+(ad?" cursor-default":"")});W=0;X=0;O=[]}}}for(var aA=0,S,aD=[],O=[],X=0,aw=0;aA<U.length;aA++){S=U[aA];aB.push(S);aD.push(!!S.collapsed);O.push(!!S.empty);X+=S.value;aw++;if(aw===E.span[0]){var ad=!Ext.Array.contains(O,false);aB.push({type:"valueTotalSubgrandtotal",cls:"pivot-value-total-subgrandtotal"+(ad?" cursor-default":""),value:X,htmlValue:ad?"&nbsp;":y(X),empty:ad,collapsed:!Ext.Array.contains(aD,false)});aD=[];O=[];X=0;aw=0}}aa=an;ap=aj;U=aB}for(var aA=0,ac;aA<ap.length;aA++){ac=[];ac=ac.concat(aa[aA]);ac=ac.concat(ap[aA]);if(L){ac=ac.concat(U[aA])}ai.push(ac)}for(var aA=0,ac;aA<ai.length;aA++){ac=[];for(var az=0;az<ai[aA].length;az++){ac.push(G(ai[aA][az]))}aE.push(ac)}return aE};x=function(){var V=[];if(E&&s()){var Y;for(var Q=0,U=0,T=[];Q<M[0].length;Q++){for(var O=0,P;O<M.length;O++){P=M[O][Q];U+=P.value;T.push(!!P.empty)}t.push({type:"valueTotal",value:U,htmlValue:Ext.Array.contains(T,false)?y(U):"",empty:!Ext.Array.contains(T,false),cls:"pivot-value-total"});U=0;T=[]}Y=t;if(L&&doRowSubTotals()){var R=[];for(var Q=0,X,S=0,T=[],W=0;Q<Y.length;Q++){X=Y[Q];R.push(X);S+=X.value;T.push(!!X.empty);W++;if(W===K){R.push({type:"valueTotalSubgrandtotal",value:S,htmlValue:Ext.Array.contains(T,false)?y(S):"",empty:!Ext.Array.contains(T,false),cls:"pivot-value-total-subgrandtotal"});S=0;W=0}}Y=R}for(var Q=0;Q<Y.length;Q++){V.push(G(Y[Q]))}}return V};C=function(){var Q=0,R=[],O=[];if(r()&&s()){for(var P=0,S;P<t.length;P++){S=t[P];Q+=S.value;R.push(S.empty)}if(L&&E){O.push(G({type:"valueGrandTotal",cls:"pivot-value-grandtotal",value:Q,htmlValue:Ext.Array.contains(R,false)?y(Q):"",empty:!Ext.Array.contains(R,false)}))}}return O};H=function(){var Q,P=x(),R=C(),S,O=[];if(s()){if(E){Q=[G({type:"dimensionSubtotal",cls:"pivot-dim-total",colSpan:E.dims,htmlValue:"Total"})]}S=[].concat(Q||[],P||[],R||[]);O.push(S)}return O};N=function(){var P='<table id="'+F.tableUuid+'" class="pivot">';for(var O=0;O<J.length;O++){P+="<tr>"+J[O].join("")+"</tr>"}return P+="</table>"};return function(){J=Ext.Array.clean([].concat(I()||[],u()||[],H()||[]));return{html:N(J),uuidDimUuidsMap:A,xColAxis:L,xRowAxis:E,tdCount:p}}()}}());(function(){if(Ext.isArray(m.dimensions)){j.prototype.array.sort(m.dimensions);for(var n=0,o;n<m.dimensions.length;n++){o=m.dimensions[n];o.dimensionName=o.id;o.objectName=i.finals.dimension.dimension.objectName;i.finals.dimension.objectNameMap[o.id]=o}}if(m.user&&m.user.ouc){j.prototype.array.sort(m.user.ouc)}m.idLegendSetMap={};for(var n=0,p;n<m.legendSets.length;n++){p=m.legendSets[n];m.idLegendSetMap[p.id]=p}}());return{conf:i,api:k,support:j,service:g,web:h,init:m}};css="table.pivot { \n font-family: arial,sans-serif,ubuntu,consolas; \n } \n";css+=".td-nobreak { \n white-space: nowrap; \n } \n";css+=".td-hidden { \n display: none; \n } \n";css+=".td-collapsed { \n display: none; \n } \n";css+="table.pivot { \n border-collapse: collapse; \n border-spacing: 0px; \n border: 0 none; \n } \n";css+=".pivot td { \n padding: 5px; \n border: \n 1px solid #b2b2b2; \n } \n";css+=".pivot-dim { \n background-color: #dae6f8; \n text-align: center; \n } \n";css+=".pivot-dim.highlighted { \n	background-color: #c5d8f6; \n } \n";css+=".pivot-dim-subtotal { \n background-color: #cad6e8; \n text-align: center; \n } \n";css+=".pivot-dim-total { \n background-color: #bac6d8; \n text-align: center; \n } \n";css+=".pivot-dim-total.highlighted { \n background-color: #adb8c9; \n } \n";css+=".pivot-dim-empty { \n background-color: #dae6f8; \n text-align: center; \n } \n";css+=".pivot-value { \n background-color: #fff; \n white-space: nowrap; \n text-align: right; \n } \n";css+=".pivot-value-subtotal { \n background-color: #f4f4f4; \n white-space: nowrap; \n text-align: right; \n } \n";css+=".pivot-value-subtotal-total { \n background-color: #e7e7e7; \n white-space: nowrap; \n text-align: right; \n } \n";css+=".pivot-value-total { \n background-color: #e4e4e4; \n white-space: nowrap; \n text-align: right; \n } \n";css+=".pivot-value-total-subgrandtotal { \n background-color: #d8d8d8; \n white-space: nowrap; \n text-align: right; \n } \n";css+=".pivot-value-grandtotal { \n background-color: #c8c8c8; \n white-space: nowrap; \n text-align: right; \n } \n";css+=".pivot-dim-label { \n background-color: #cddaed; \n white-space: nowrap; \n text-align: center; \n } \n";css+=".pivot-empty { \n background-color: #cddaed; \n } \n";css+=".pivot-transparent-column { \n background-color: #fff; \n border-top-color: #fff !important; \n border-right-color: #fff !important; \n } \n";css+=".pivot-transparent-row { \n background-color: #fff; \n border-bottom-color: #fff !important; \n border-left-color: #fff !important; \n } \n";css+=".x-mask-msg { \n padding: 0; \n	border: 0 none; \n background-image: none; \n background-color: transparent; \n } \n";css+=".x-mask-msg div { \n background-position: 11px center; \n } \n";css+=".x-mask-msg .x-mask-loading { \n border: 0 none; \n	background-color: #000; \n color: #fff; \n border-radius: 2px; \n padding: 12px 14px 12px 30px; \n opacity: 0.65; \n } \n";css+=".x-mask { opacity: 0 } \n";css+=".pivot td.legend { \n padding: 0; \n } \n";css+=".pivot div.legendCt { \n display: table; \n float: right; \n width: 100%; \n } \n";css+=".pivot div.arrowCt { \n display: table-cell; \n vertical-align: top; \n width: 8px; \n } \n";css+=".pivot div.arrow { \n width: 0; \n height: 0; \n } \n";css+=".pivot div.number { \n display: table-cell; \n } \n",css+=".pivot div.legendColor { \n display: table-cell; \n width: 2px; \n } \n";css+=".pointer { \n cursor: pointer; \n } \n";css+='.td-sortable { \n background-image: url("https://dhis2-cdn.org/v214/plugin/images/arrowupdown.png"); \n background-repeat: no-repeat; \n background-position: right center; \n padding-right: 15px !important; \n } \n';Ext.util.CSS.createStyleSheet(css);PT.plugin={};var e={user:{}},d=[],f=false,b=false,a,c;a=function(g){var m=false,l=[],k=0,j;e.contextPath=g;j=function(){if(++k===l.length){b=true;for(var n=0;n<d.length;n++){c(d[n])}d=[]}};l.push({url:e.contextPath+"/api/me/user-account.jsonp",success:function(s){e.userAccount=s;var q="en",o="name",n,p,i;e.userAccount.settings.keyUiLocale=e.userAccount.settings.keyUiLocale||q;e.userAccount.settings.keyAnalysisDisplayProperty=e.userAccount.settings.keyAnalysisDisplayProperty||o;p=e.contextPath;i=e.userAccount.settings.keyUiLocale;keyAnalysisDisplayProperty=e.userAccount.settings.keyAnalysisDisplayProperty;n=keyAnalysisDisplayProperty===o?keyAnalysisDisplayProperty:keyAnalysisDisplayProperty+"|rename("+o+")";e.namePropertyUrl=n;j()}});l.push({url:g+"/api/organisationUnits.jsonp?userOnly=true&fields=id,name,children[id,name]&paging=false",success:function(q){var p=q.organisationUnits||[],o=[],s=[];if(p.length){for(var n=0,t;n<p.length;n++){t=p[n];o.push(t.id);if(t.children){s=Ext.Array.clean(s.concat(Ext.Array.pluck(t.children,"id")||[]))}}e.user=e.user||{};e.user.ou=o;e.user.ouc=s}else{alert("User is not assigned to any organisation units")}j()}});e.legendSets=[];l.push({url:g+"/api/dimensions.jsonp?links=false&paging=false",success:function(i){e.dimensions=i.dimensions;j()}});for(var h=0;h<l.length;h++){Ext.data.JsonP.request(l[h])}};c=function(j){var l,i,h,g,k={core:{},app:{}};l=function(m){if(!Ext.isObject(m)){console.log("Report table configuration is not an object");return}if(!Ext.isString(m.el)){console.log("No valid element id provided");return}m.id=m.id||m.uid;return true};i=function(q){var r=k.core.init,p=k.core.api,o=k.core.support,m=k.core.service,n=k.core.web;n.events=n.events||{};n.events.setColumnHeaderMouseHandlers=function(w,t,s,y){if(Ext.isArray(y.sortableIdObjects)){for(var u=0,x,v;u<y.sortableIdObjects.length;u++){x=y.sortableIdObjects[u];v=Ext.get(x.uuid);v.dom.layout=w;v.dom.xLayout=t;v.dom.response=s;v.dom.xResponse=y;v.dom.metaDataId=x.id;v.dom.onColumnHeaderMouseClick=n.events.onColumnHeaderMouseClick;v.dom.onColumnHeaderMouseOver=n.events.onColumnHeaderMouseOver;v.dom.onColumnHeaderMouseOut=n.events.onColumnHeaderMouseOut;v.dom.setAttribute("onclick","this.onColumnHeaderMouseClick(this.layout, this.xLayout, this.response, this.xResponse, this.metaDataId)");v.dom.setAttribute("onmouseover","this.onColumnHeaderMouseOver(this)");v.dom.setAttribute("onmouseout","this.onColumnHeaderMouseOut(this)")}}};n.events.onColumnHeaderMouseClick=function(u,t,s,v,w){if(u.sorting&&u.sorting.id===w){u.sorting.direction=o.prototype.str.toggleDirection(u.sorting.direction)}else{u.sorting={id:w,direction:"DESC"}}n.mask.show(k.app.centerRegion,"Sorting...");Ext.defer(function(){n.pivot.createTable(u,s,null,false)},10)};n.events.onColumnHeaderMouseOver=function(s){Ext.get(s).addCls("pointer highlighted")};n.events.onColumnHeaderMouseOut=function(s){Ext.get(s).removeCls("pointer highlighted")};n.pivot=n.pivot||{};n.pivot.loadTable=function(s){if(!Ext.isString(s)){alert("Invalid report table id");return}Ext.data.JsonP.request({url:r.contextPath+"/api/reportTables/"+s+".jsonp?fields="+k.core.conf.url.analysisFields.join(","),failure:function(t){window.open(r.contextPath+"/api/reportTables/"+s+".json?fields="+k.core.conf.url.analysisFields.join(","),"_blank")},success:function(u){var t=p.layout.Layout(u);if(t){n.pivot.getData(t,true)}}})};n.pivot.getData=function(t,u){var s,v;if(!t){return}s=m.layout.getExtendedLayout(t);v=n.analytics.getParamString(s,true);n.mask.show(k.app.centerRegion);Ext.data.JsonP.request({url:r.contextPath+"/api/analytics.jsonp"+v,timeout:60000,headers:{"Content-Type":"application/json",Accepts:"application/json"},disableCaching:false,failure:function(w){n.mask.hide(k.app.centerRegion);window.open(r.contextPath+"/api/analytics.json"+v,"_blank")},success:function(x){var w=p.response.Response(x);if(!w){n.mask.hide(k.app.centerRegion);return}k.app.paramString=v;n.pivot.createTable(t,w,null,u)}})};n.pivot.createTable=function(y,w,E,t){var C,s,v,D,x,A=m.layout.getExtendedLayout,u=m.layout.getSyncronizedXLayout,z=m.response.getExtendedResponse,B=m.layout.getExtendedAxis;x=function(F,G){s=B(F,"col");v=B(F,"row");return n.pivot.getHtml(F,G,s,v)};C=u(A(y),E||w);k.app.dateSorting=new Date();if(y.sorting){if(!E){E=z(C,w);x(C,E)}n.pivot.sort(C,E,s||k.app.xColAxis);C=A(p.layout.Layout(C))}else{E=m.response.getExtendedResponse(C,w)}D=x(C,E);k.app.dateRender=new Date();k.app.centerRegion.update(D.html);Ext.defer(function(){Ext.get(k.core.init.el).fadeIn({duration:400})},300);k.app.layout=y;k.app.xLayout=C;k.app.response=w;k.app.xResponse=E;k.app.uuidDimUuidsMap=j.uuidDimUuidsMap;k.app.uuidObjectMap=Ext.applyIf((s?s.uuidObjectMap:{}),(v?v.uuidObjectMap:{}));n.events.setColumnHeaderMouseHandlers(y,C,w,E);n.mask.hide(k.app.centerRegion);if(PT.isDebug){console.log("layout",y);console.log("response",w);console.log("xResponse",E);console.log("xLayout",C);console.log("core",k.core);console.log("app",k.app)}}};h=function(){return{centerRegion:Ext.get(j.el)}};g=function(){if(!l(j)){return}k.core=PT.getCore(Ext.clone(e));k.core.init.el=j.el;Ext.get(k.core.init.el).setStyle("opacity",0);i(k);k.app.viewport=h();k.app.centerRegion=k.app.viewport.centerRegion;if(j.id){k.core.web.pivot.loadTable(j.id)}else{layout=k.core.api.layout.Layout(j);if(!layout){return}k.core.web.pivot.getData(layout)}}()};PT.plugin.getTable=function(g){if(Ext.isString(g.url)&&g.url.split("").pop()==="/"){g.url=g.url.substr(0,g.url.length-1)}if(b){c(g)}else{d.push(g);if(!f){f=true;a(g.url)}}};DHIS=Ext.isObject(window.DHIS)?DHIS:{};DHIS.getTable=PT.plugin.getTable});
